# -*- Makefile -*-
htdocsdir = $(pkgdatadir)/htdocs

dist_htdocs_DATA :=				\
	src/www/dragonfly.html			\
	src/www/dragonfly-debug.html    \
	src/www/favicon.ico

htl10ndir = $(htdocsdir)/l10n
htl10n_DATA := $(htl10n_jsfiles)

cssdir = $(htdocsdir)/css

dist_css_DATA :=				\
	src/www/css/interpreter.css		\
	src/www/css/layout.css			\
	src/www/css/widgets.css         \
	src/www/css/login.css			\
	src/www/css/composer.css		\
	src/www/css/conversation.css		\
	src/www/css/contacts.css		\
	src/www/css/calendar.css		\
	src/www/css/summary.css			\
	src/www/css/print.css			\
	src/www/css/admin.css
	
screencssdir = $(cssdir)

compress_script := $(top_srcdir)/src/www/compress.py

dist_screencss_DATA =                  \
	src/www/css/screen.css

src/www/css/screen.css: $(dist_css_DATA)
	$(compress_script) $(dist_css_DATA) --measure -o src/www/css/screen.css -i src/www/css/print.css -i src/www/css/admin.css --no-linebreaks

imgdir = $(htdocsdir)/img

dist_img_DATA :=					     \
	src/www/img/accessories-text-editor.gif		     \
	src/www/img/accessories-text-editor.png		     \
	src/www/img/addressbook-16.png			     \
	src/www/img/airplane-emblem.png			     \
	src/www/img/applications-internet.gif		     \
	src/www/img/applications-internet.png		     \
	src/www/img/arrow.png				     \
	src/www/img/ajax-loader.gif              \
	src/www/img/bg-button.png			     \
	src/www/img/bg-button-pressed.png		     \
	src/www/img/bg-button-selected.png		     \
	src/www/img/bg-header.png			     \
	src/www/img/bg-page.png				     \
	src/www/img/bg-selected.png			     \
	src/www/img/bg-shine.png			     \
	src/www/img/bg-side-title-hover.png		     \
	src/www/img/bg-side-title.png			     \
	src/www/img/bg-tab-selected.png			     \
	src/www/img/bg-timestrip.png			     \
	src/www/img/bg-timestrip-right.png		     \
	src/www/img/bg-toolbar.png			     \
	src/www/img/blank.gif				     \
	src/www/img/calendar-16.gif			     \
	src/www/img/calendar-16.png			     \
	src/www/img/cal-offmonth.png			     \
	src/www/img/cal-selected.png			     \
	src/www/img/cal-selected-stipple.png		     \
	src/www/img/cal-today.png			     \
	src/www/img/cal-today-stipple.png		     \
	src/www/img/close.gif			     \
	src/www/img/closed-read.png			     \
	src/www/img/closed-unread.png			     \
	src/www/img/contact-16.png			     \
	src/www/img/contact-new.png			     \
	src/www/img/contact-unknown.png			     \
	src/www/img/continued-left.png			     \
	src/www/img/continued-right.png			     \
	src/www/img/dialog-information.gif		     \
	src/www/img/dialog-information.png		     \
	src/www/img/dragonfly-favicon.png		     \
	src/www/img/dragonfly.png			     \
	src/www/img/emblem-readonly.gif			     \
	src/www/img/emblem-readonly.png			     \
	src/www/img/event-16.png			     \
	src/www/img/go-next.png				     \
	src/www/img/go-previous.png			     \
	src/www/img/grad-cal.png			     \
	src/www/img/grad-cal-title.png			     \
	src/www/img/grad-page.png			     \
	src/www/img/grad.png				     \
	src/www/img/grad-tab.png			     \
	src/www/img/grad-textarea.png			     \
	src/www/img/grad-toolbar.png			     \
	src/www/img/big-info.png				     \
	src/www/img/grippy.png				     \
	src/www/img/grippy-h.gif			     \
	src/www/img/grippy-h.png			     \
	src/www/img/grippy-v.gif			     \
	src/www/img/grippy-v.png			     \
	src/www/img/histogram.png			     \
	src/www/img/home-16.png				     \
	src/www/img/home-16.gif				     \
	src/www/img/bongo-favicon.gif			     \
	src/www/img/bongo-favicon.ico			     \
	src/www/img/bongo-favicon.png			     \
	src/www/img/icon-simple-calendars.gif		     \
	src/www/img/icon-simple-calendars.png		     \
	src/www/img/icon-simple-contacts.gif		     \
	src/www/img/icon-simple-contacts.png		     \
	src/www/img/icon-simple-todos.gif		     \
	src/www/img/icon-simple-todos.png		     \
	src/www/img/image-x-generic.png			     \
	src/www/img/info-bl.gif				     \
	src/www/img/info-bl.png				     \
	src/www/img/info-br.gif				     \
	src/www/img/info-br.png				     \
	src/www/img/info-cl.gif				     \
	src/www/img/info-cl.png				     \
	src/www/img/info-cr.gif				     \
	src/www/img/info-cr.png				     \
	src/www/img/info-pointer-down.gif		     \
	src/www/img/info-pointer-down.png		     \
	src/www/img/info-pointer-left.gif		     \
	src/www/img/info-pointer-left.png		     \
	src/www/img/info-pointer-right.gif		     \
	src/www/img/info-pointer-right.png		     \
	src/www/img/info-pointer-up.gif			     \
	src/www/img/info-pointer-up.png			     \
	src/www/img/info-tl.gif				     \
	src/www/img/info-tl.png				     \
	src/www/img/info-tr.gif				     \
	src/www/img/info-tr.png				     \
	src/www/img/lightbulb.png			     \
	src/www/img/link-underline-view-active.gif	     \
	src/www/img/link-underline-view.gif		     \
	src/www/img/login-bg-bottom.png			     \
	src/www/img/login-bg-middle.png			     \
	src/www/img/login-bg-top.png			     \
	src/www/img/login-logo.gif			     \
	src/www/img/login-logo.png			     \
	src/www/img/mail-closed-16.png			     \
	src/www/img/mail-forward-16.png			     \
	src/www/img/mail-inbox-16.png			     \
	src/www/img/mail-inbox-22.png			     \
	src/www/img/mail-reply-all-16.png		     \
	src/www/img/mail-reply-sender-16.png		     \
	src/www/img/message-16.gif			     \
	src/www/img/message-16.png			     \
	src/www/img/message-closed-16.png		     \
	src/www/img/minus.png				     \
	src/www/img/msg-gradient.png			     \
	src/www/img/navselhilight.png			     \
	src/www/img/open-read.png			     \
	src/www/img/open-unread.png			     \
	src/www/img/plus.png				     \
	src/www/img/popup.png				     \
	src/www/img/read-gradient.png			     \
	src/www/img/sad.png                      \
	src/www/img/side-bl.png				     \
	src/www/img/side-br.png				     \
	src/www/img/side-cl.png				     \
	src/www/img/side-cr.png				     \
	src/www/img/side-tl.png				     \
	src/www/img/side-tr.png				     \
	src/www/img/star.png				     \
	src/www/img/star-widget.gif			     \
	src/www/img/star-widget.png			     \
	src/www/img/system-search.gif			     \
	src/www/img/system-search.png			     \
	src/www/img/text-x-generic.png			     \
	src/www/img/top-gradient.png			     \
	src/www/img/unread-gradient.png			     \
	src/www/img/x.png				     \
	src/www/img/toolbar/edit-redo.png		     \
	src/www/img/toolbar/edit-undo.png		     \
	src/www/img/toolbar/format-indent-less.png	     \
	src/www/img/toolbar/format-indent-more.png	     \
	src/www/img/toolbar/format-justify-center.png	     \
	src/www/img/toolbar/format-justify-fill.png	     \
	src/www/img/toolbar/format-justify-left.png	     \
	src/www/img/toolbar/format-justify-right.png	     \
	src/www/img/toolbar/format-text-bold.png	     \
	src/www/img/toolbar/format-text-italic.png	     \
	src/www/img/toolbar/format-text-strikethrough.png    \
	src/www/img/toolbar/format-text-underline.png	     \
	src/www/img/toolbar/16/edit-redo.png		     \
	src/www/img/toolbar/16/edit-undo.png		     \
	src/www/img/toolbar/16/format-indent-less.png	     \
	src/www/img/toolbar/16/format-indent-more.png	     \
	src/www/img/toolbar/16/format-justify-center.png     \
	src/www/img/toolbar/16/format-justify-fill.png	     \
	src/www/img/toolbar/16/format-justify-left.png	     \
	src/www/img/toolbar/16/format-justify-right.png	     \
	src/www/img/toolbar/16/format-text-bold.png	     \
	src/www/img/toolbar/16/format-text-italic.png	     \
	src/www/img/toolbar/16/format-text-strikethrough.png \
	src/www/img/toolbar/16/format-text-underline.png     \
	src/www/img/toolbar/16/mail-attachment.png  \
	src/www/img/bg.png  \
	src/www/img/Bongo-logo.png \
	src/www/img/cbg.png \
	src/www/img/desktop-big.png \
	src/www/img/dialog-error-32.png \
	src/www/img/dialog-information-32.png \
	src/www/img/dialog-warning.png \
	src/www/img/form_buttons.png    \
	src/www/img/form_buttons.gif    \
	src/www/img/help-browser.png \
	src/www/img/locked.png \
	src/www/img/locale.png  \
	src/www/img/login-pane.png \
	src/www/img/network-server.png \
	src/www/img/sel.png \
	src/www/img/sbg.png \
	src/www/img/system-installer.png \
	src/www/img/system-users.png \
	src/www/img/user.png \
	src/www/img/user-desktop.png


jsdir = $(htdocsdir)/js

# These *must* be in the order in which they get loaded in the browser
dist_js_DATA :=					\
    src/www/js/Dragonfly.js			\
    src/www/js/Format.js			\
    src/www/js/Gettext.js			\
    src/www/js/Cookie.js			\
    src/www/js/Location.js			\
    src/www/js/Login.js			\
    src/www/js/Util.js			\
    src/www/js/Widgets.js   \
    src/www/js/ValidatingEntry.js		\
    src/www/js/Preferences.js		\
	src/www/js/AddressBook.js		\
	src/www/js/JCal.js			\
	src/www/js/Calendar.js			\
	src/www/js/BongoCalendar.js		\
	src/www/js/CalendarEditor.js		\
	src/www/js/OccurrenceEditor.js		\
	src/www/js/CalendarView.js		\
	src/www/js/CalendarLayout.js		\
	src/www/js/CalendarDrag.js		\
	src/www/js/CalendarWidgets.js		\
	src/www/js/Summary.js			\
	src/www/js/Search.js			\
	src/www/js/Mail.js			\
	src/www/js/MailWidgets.js		\
	src/www/js/Composer.js			\
	src/www/js/MailConversationView.js	\
	src/www/js/MailListView.js		\
	src/www/js/Browser.js   \
	src/www/js/BrowserCheck.js
	
eAreadir = $(htdocsdir)/js/eArea

dist_eArea_DATA := \
    src/www/js/eArea/editableArea.js    \
	src/www/js/eArea/blank.html
	
eAreaimagedir = $(htdocsdir)/js/eArea/icons

dist_eAreaimage_DATA := \
    src/www/js/eArea/icons/edit-select-all.png       \
    src/www/js/eArea/icons/edit-undo.png        \
    src/www/js/eArea/icons/edit-redo.png        \
    src/www/js/eArea/icons/format-justify-center.png        \
    src/www/js/eArea/icons/format-justify-left.png          \
    src/www/js/eArea/icons/format-justify-right.png         \
    src/www/js/eArea/icons/format-justify-fill.png          \
    src/www/js/eArea/icons/format-text-bold.png     \
    src/www/js/eArea/icons/format-text-italic.png       \
    src/www/js/eArea/icons/format-indent-more.png       \
    src/www/js/eArea/icons/format-indent-less.png       \
    src/www/js/eArea/icons/insert-image.png         \
    src/www/js/eArea/icons/insert-link.png          \
    src/www/js/eArea/icons/toolbar-seperator.png

plugindir = $(htdocsdir)/plugins

dist_plugin_DATA := \
    src/www/plugins/example.js

prototypedir = $(jsdir)/lib/prototype

dist_prototype_DATA := \
	src/www/js/lib/prototype/prototype.js

mochidir = $(jsdir)/lib/MochiKit

# These *must* be in the order in which they get loaded in the browser/MochiKit
dist_mochi_DATA :=				   \
    src/www/js/lib/MochiKit/Base.js		   \
    src/www/js/lib/MochiKit/Iter.js		   \
    src/www/js/lib/MochiKit/Logging.js	   \
    src/www/js/lib/MochiKit/DateTime.js	   \
    src/www/js/lib/MochiKit/Format.js	   \
	src/www/js/lib/MochiKit/Async.js	   \
	src/www/js/lib/MochiKit/DOM.js		   \
	src/www/js/lib/MochiKit/LoggingPane.js	   \
	src/www/js/lib/MochiKit/Color.js	   \
	src/www/js/lib/MochiKit/Signal.js	   \
	src/www/js/lib/MochiKit/Visual.js      \
	src/www/js/lib/MochiKit/MochiKit.js	   \
	src/www/js/lib/MochiKit/interpreter.js

scriptaculousdir = $(jsdir)/lib/script.aculo.us

# Same as with above JS.
dist_scriptaculous_DATA :=				\
	src/www/js/lib/script.aculo.us/effects.js   \
	src/www/js/lib/script.aculo.us/controls.js

finaljsdir = $(jsdir)

dist_finaljs_DATA =						\
	src/www/js/final.js

src/www/js/final.js: $(dist_js_DATA) $(dist_prototype_DATA) $(dist_scriptaculous_DATA) $(dist_mochi_DATA)
	$(compress_script) $(dist_prototype_DATA) $(dist_scriptaculous_DATA) $(dist_mochi_DATA) $(dist_js_DATA) src/www/js/eArea/editableArea.js -o src/www/js/final.js --measure --type js

install-data-local:: install-dist_htdocsDATA
	ln -sf dragonfly.html "$(DESTDIR)$(htdocsdir)/index.html"

pkgpythondragonflydir = $(pkgpythondir)/dragonfly

pkgpythondragonfly_PYTHON :=			   \
	src/www/bongo/dragonfly/__init__.py	   \
	src/www/bongo/dragonfly/AddressbookView.py  \
	src/www/bongo/dragonfly/Auth.py		   \
	src/www/bongo/dragonfly/CalendarView.py	   \
	src/www/bongo/dragonfly/Composer.py	   \
	src/www/bongo/dragonfly/MailView.py	   \
	src/www/bongo/dragonfly/PreferencesView.py  \
	src/www/bongo/dragonfly/ResourceHandler.py  \
	src/www/bongo/dragonfly/ResourcePath.py	   \
	src/www/bongo/dragonfly/Server.py	   \
	src/www/bongo/dragonfly/SmsHandler.py	   \
	src/www/bongo/dragonfly/SummaryView.py

pkgpythonhawkeyedir = $(pkgpythondir)/hawkeye

pkgpythonhawkeye_PYTHON :=			\
	src/www/bongo/hawkeye/__init__.py	\
	src/www/bongo/hawkeye/AntispamView.py   \
	src/www/bongo/hawkeye/AgentView.py  \
	src/www/bongo/hawkeye/Auth.py		\
	src/www/bongo/hawkeye/BackupView.py      \
	src/www/bongo/hawkeye/HawkeyeHandler.py	\
	src/www/bongo/hawkeye/HawkeyePath.py	\
	src/www/bongo/hawkeye/SystemView.py \
	src/www/bongo/hawkeye/RootView.py	\
	src/www/bongo/hawkeye/Server.py		\
	src/www/bongo/hawkeye/ServerView.py	\
	src/www/bongo/hawkeye/UsersView.py

pkgpythonsundialdir = $(pkgpythondir)/sundial

pkgpythonsundial_PYTHON :=			\
	src/www/bongo/sundial/__init__.py	\
	src/www/bongo/sundial/SundialHandler.py \
	src/www/bongo/sundial/SundialPath.py	\
	src/www/bongo/sundial/Auth.py			\
	src/www/bongo/sundial/GetView.py		\
	src/www/bongo/sundial/PropfindView.py	\
	src/www/bongo/sundial/OptionsView.py	\
	src/www/bongo/sundial/ReportView.py		\
	src/www/bongo/sundial/DeleteView.py

pkgpythoncommonwebdir = $(pkgpythondir)/commonweb

pkgpythoncommonweb_PYTHON :=		\
	src/www/bongo/commonweb/__init__.py	\
	src/www/bongo/commonweb/HttpError.py	\
	src/www/bongo/commonweb/ApacheLogHandler.py \
	src/www/bongo/commonweb/BongoCookie.py	   \
	src/www/bongo/commonweb/BongoFieldStorage.py \
	src/www/bongo/commonweb/BongoUtil.py         \
	src/www/bongo/commonweb/Standalone.py	   \
	src/www/bongo/commonweb/BongoSession.py		\
	src/www/bongo/commonweb/ElementTree.py

hawkeyetplrootdir = $(htdocsdir)/hawkeye/root
dist_hawkeyetplroot_DATA :=			\
	src/www/hawkeye/root/login.tpl		\
	src/www/hawkeye/root/test.tpl		\
	src/www/hawkeye/root/test-hello.tpl	\
	src/www/hawkeye/root/index.tpl

hawkeyetplbackupdir = $(htdocsdir)/hawkeye/backup
dist_hawkeyetplbackup_DATA :=			\
        src/www/hawkeye/backup/index.tpl

hawkeyetplserverdir = $(htdocsdir)/hawkeye/server
dist_hawkeyetplserver_DATA :=			\
        src/www/hawkeye/server/index.tpl
        
hawkeyetplsystemdir = $(htdocsdir)/hawkeye/system
dist_hawkeyetplsystem_DATA :=			\
        src/www/hawkeye/system/index.tpl
        
hawkeyetplagentsdir = $(htdocsdir)/hawkeye/agents
dist_hawkeyetplagents_DATA :=			\
        src/www/hawkeye/agents/index.tpl
        
hawkeyetplantispamdir = $(htdocsdir)/hawkeye/antispam
dist_hawkeyetplantispam_DATA :=			\
        src/www/hawkeye/antispam/index.tpl

hawkeyetpldir = $(htdocsdir)/hawkeye
dist_hawkeyetpl_DATA :=			\
	src/www/hawkeye/footer.tpl	\
	src/www/hawkeye/header.tpl

src/www/bongo-standalone: $(top_builddir)/src/libs/python/bongo-python-wrapper
	$(INSTALL) -m 755 $< $@

dist_pkglibexec_SCRIPTS += src/www/bongo-standalone.py

sbin_SCRIPTS += \
	src/www/bongo-standalone

dist_noinst_SCRIPTS += \
	src/www/l10n/po2json \
	src/www/compress.py

templatesdir = $(pkgdatadir)/templates

dist_templates_DATA :=				\
	src/www/templates/month-view.html	\
	src/www/templates/event.html

exampledir = $(pkgdatadir)/examples

example_DATA := \
	src/www/bongo.conf

dist_noinst_DATA +=				   \
	src/www/js/lib/prototype/LICENSE	   \
	src/www/js/lib/MochiKit/LICENSE.txt	   \
	src/www/js/lib/script.aculo.us/MIT-LICENSE \
	src/www/bongo/__init__.py.in		   \
	src/www/bongo-devel.conf

noinst_DATA += \
	src/www/bongo/__init__.py

src/www/bongo/__init__.py: src/www/bongo/__init__.py.in $(top_srcdir)/src/libs/python/bongo/__init__.py
	cp $< $@.tmp
	cat $(top_srcdir)/src/libs/python/bongo/__init__.py >> $@.tmp
	mv $@.tmp $@

src/www/bongo-devel.conf: src/www/bongo.conf.in Makefile
	sed -e "s%\@DATADIR\@/\@PACKAGE\@/htdocs%${top_srcdir}/src/www%" \
	-e "s%\@APACHE_MOD_DIR\@%${APACHE_MOD_DIR}%" \
	-e "s%\@PYTHONDIR\@%${top_srcdir}/src/www%" \
	-e "s%\@SHARED_POSTFIX\@%${SHARED_POSTFIX}%" \
	-e "s%\@DATADIR\@/\@PACKAGE\@/hawkeye%${top_srcdir}/src/www/hawkeye%" \
	$< > $@

po2json := $(top_srcdir)/src/www/l10n/po2json

src/www/l10n/%.js: po/bongo-web/%.gmo config.status
	$(po2json) -p po/bongo-web/$*.po -o $@

# This generates no translation. It simply does msgid:msgid on the potfile.
src/www/l10n/en.js: config.status
	$(po2json) -p po/bongo-web.pot -o $@ --en

CLEANFILES +=					\
	src/www/bongo-standalone			\
	src/www/*.pyc				\
	src/www/bongo/__init__.py		\
	src/www/bongo-devel.conf			\
	src/www/bongo/*.pyc			\
	src/www/bongo/__init__.py		\
	src/www/bongo/dragonfly/*.pyc

src/www/all: src/www/bongo/__init__.py src/www/bongo-devel.conf src/www/bongo.conf
src/www/clean: clean
